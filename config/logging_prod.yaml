version: 1
disable_existing_loggers: false

formatters:
  json:  # JSON 结构化格式
    class: config.log_config.JsonFormatter  # 指向自定义的 JsonFormatter 类
    format: "%(asctime)s %(levelname)s %(name)s %(module)s %(lineno)d %(message)s %(exc_info)s"
    rename_fields:
      asctime: timestamp
      levelname: level

handlers:
  file:
    class: logging.handlers.RotatingFileHandler
    level: INFO
    formatter: json
    filename: "./logs/app.log"  # 日志文件路径（实际运行时会被 settings.LOG_DIR 替换）
    maxBytes: 10485760  # 10MB 轮转
    backupCount: 10  # 保留10个备份
    encoding: utf-8
  error_file:  # 单独记录错误日志
    class: logging.handlers.RotatingFileHandler
    level: ERROR
    formatter: json
    filename: "./logs/error.log"
    maxBytes: 10485760
    backupCount: 10
    encoding: utf-8

loggers:
  app:
    level: INFO
    handlers: [file, error_file]
    propagate: false
  uvicorn:
    level: WARNING  # 生产环境只看警告及以上
    handlers: [file]
    propagate: false
  sqlalchemy:
    level: WARNING
    handlers: [file]
    propagate: false

root:
  level: INFO
  handlers: [file]